# 開発ガイドライン

## AIアシスタントツール統合
このプロジェクトでは、Claude CodeとCodex（Cursor）の両方のAIアシスタントを使用しています。
どちらのツールを使用する場合も、以下のガイドラインに従ってください。

### 共通ルール
- **一貫性を保つ** - どのツールを使用しても同じコーディングスタイルとパターンを維持
- **コンテキスト共有** - 重要な変更や決定事項は`CLAUDE.md`に記録し、両ツール間で共有
- **相互補完** - 各ツールの強みを活かし、タスクに応じて適切に使い分ける

## 哲学

### 核となる信念
- **大きな変更より段階的な進歩** - コンパイルが通りテストに合格する小さな変更を行う
- **既存コードから学ぶ** - 実装前に研究し計画する
- **独断的より実用的** - プロジェクトの現実に適応する
- **巧妙なコードより明確な意図** - 退屈で明白なコードを書く

### シンプルさとは
- 関数/クラスごとに単一の責任
- 早すぎる抽象化を避ける
- 巧妙なトリックは使わない - 退屈な解決策を選ぶ
- 説明が必要なら、それは複雑すぎる

## プロセス

### 1. 計画とステージング
複雑な作業を3-5段階に分割。`IMPLEMENTATION_PLAN.md`に文書化：

```md
## ステージ N: [名前]
**目標**: [具体的な成果物]
**成功基準**: [テスト可能な結果]
**テスト**: [具体的なテストケース]
**ステータス**: [未開始|進行中|完了]
```

- 進捗に応じてステータスを更新
- すべてのステージが完了したらファイルを削除

### 2. 実装フロー
1. **理解** - コードベースの既存パターンを研究
2. **テスト** - 最初にテストを書く（レッド）
3. **実装** - テストをパスする最小限のコード（グリーン）
4. **リファクタリング** - テストをパスした状態でクリーンアップ
5. **コミット** - 計画にリンクした明確なメッセージで

### 3. 行き詰まったとき（3回試行後）
**重要**: 問題ごとに最大3回の試行、その後停止。

1. **失敗したことを文書化**：
   - 試したこと
   - 具体的なエラーメッセージ
   - 失敗したと思う理由

2. **代替案を調査**：
   - 2-3の類似実装を見つける
   - 使用された異なるアプローチをメモ

3. **基本を問い直す**：
   - これは正しい抽象化レベルか？
   - これを小さな問題に分割できるか？
   - 完全により簡単なアプローチはあるか？

4. **異なる角度から試す**：
   - 異なるライブラリ/フレームワーク機能？

## データベース設計ガイドライン（Supabase）

### ハードコーディングを避ける原則
- **環境変数の活用** - Supabase URLとAnonキーは必ず環境変数で管理
- **定数化** - テーブル名、カラム名、エラーメッセージは定数として定義
- **型定義** - データベースのスキーマに対応する型を明確に定義
- **抽象化** - データベース操作は再利用可能な関数/クラスとして実装

### 実装ルール
1. **接続情報**：
   - `.env`ファイルでSupabase URLとキーを管理
   - 本番/開発環境で異なる設定を可能に

2. **クエリ実装**：
   - SQLクエリの直書きを避ける
   - Supabaseクライアントのメソッドチェーンを活用
   - 共通操作は汎用関数として実装

3. **エラーハンドリング**：
   - データベース操作は必ずtry-catchで囲む
   - エラーメッセージは定数化
   - ユーザーフレンドリーなエラーメッセージを返す

4. **型安全性**：
   - TypeScriptの型定義を最大限活用
   - Supabaseの自動生成型を使用
   - 実行時の型チェックも実装

## デプロイメント管理

### GitHub & Vercelの統合
1. **バックアップとバージョン管理**：
   - すべての変更は必ずGitHubにプッシュ
   - 意味のある小さなコミットに分割
   - コミットメッセージは明確に

2. **Vercelデプロイメント**：
   - GitHubへのプッシュで自動デプロイ
   - 本番環境への反映を常に確認
   - 環境変数はVercelダッシュボードで管理

3. **強制デプロイ手順**：
   ```bash
   # 変更をコミット
   git add -A
   git commit -m "明確なコミットメッセージ"
   git push origin main
   
   # 強制デプロイが必要な場合
   echo "Force deploy: $(date)" > force-deploy.txt
   git add force-deploy.txt
   git commit -m "Force Vercel deployment"
   git push origin main
   ```

### 重要な原則
- **即座の反映確認** - デプロイ後は必ず本番環境で動作確認
- **ロールバック準備** - 問題が発生した場合に備えて前のバージョンを把握
- **段階的リリース** - 大きな変更は段階的にデプロイ